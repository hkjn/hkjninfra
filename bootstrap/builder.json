{"ignition":{"version":"2.0.0","config":{}},"storage":{"filesystem":[],"files":[{"filesystem":"root","path":"/etc/coreos/update.conf","contents":{"source":"data:,GROUP%3Dbeta%0AREBOOT_STRATEGY%3D%22etcd-lock%22","verification":{}},"mode":420,"user":{},"group":{}},{"filesystem":"root","path":"/opt/bin/gather_facts","contents":{"source":"https://github.com/hkjn/hkjninfra/releases/download/1.5.10/gather_facts","verification":{"hash":"sha512-ff7bdbfb8fe387144529e658d04bcf78e8d4f10f36b82b78892be845b4c40b68112c35f36ea05df3d79969319dba29b2caed123f29245038ad0efa68b4a5de4d"}},"mode":493,"user":{},"group":{}},{"filesystem":"root","path":"/opt/bin/tclient","contents":{"source":"https://github.com/hkjn/hkjninfra/releases/download/1.5.10/tclient_x86_64","verification":{"hash":"sha512-dec91699a9e0b0e959346f86f7e32b65ad86ddc38836e5e6a9b815711600b0d906cd95c82c7653ef94fcc954a876096de38132611f4189082ef7f098b65f7183"}},"mode":493,"user":{},"group":{}}]},"systemd":{"units":[{"enable":true,"name":"tclient.service","contents":"[Unit]\nDescription=tclient\nAfter=network-online.target\n\n[Service]\nEnvironment=REPORT_ADDR=mon.hkjn.me:50051\nEnvironment=REPORT_FACTS_PATH=/etc/report_facts.json\nEnvironment=REPORT_TLS_CA_CERT=/etc/ssl/mon_ca.pem\nEnvironment=REPORT_TLS_CERT=/etc/ssl/client.pem\nEnvironment=REPORT_TLS_KEY=/etc/ssl/client-key.pem\n\nExecStartPre=-/bin/bash -c \"/opt/bin/gather_facts \u003e /etc/report_facts.json\"\nExecStart=/opt/bin/tclient\n\n[Install]\nWantedBy=multi-user.target\n"},{"enable":true,"name":"tclient.timer","contents":"[Unit]\nDescription=Timer that starts report_client.service\n\n[Timer]\n# Run every 5 min.\nOnCalendar=*:0/5\nPersistent=true\n\n[Install]\nWantedBy=multi-user.target\n"}],"passwd":{},"networkd":{}}}
