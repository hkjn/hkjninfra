{"ignition":{"version":"2.0.0","config":{}},"storage":{"filesystem":[],"files":[{"filesystem":"root","path":"/etc/coreos/update.conf","contents":{"source":"data:,GROUP%3Dbeta%0AREBOOT_STRATEGY%3D%22etcd-lock%22","verification":{}},"mode":420,"user":{},"group":{}},{"filesystem":"root","path":"/opt/bin/gather_facts","contents":{"source":"https://github.com/hkjn/hkjninfra/releases/download/1.5.0/gather_facts","verification":{"hash":"sha512-78d449ff5680522317d8b7e5a0210bfc5545c6a025f64d6b28a5578c3055af51d6b33699addcd19dd6072dd6ec0edb29d78fde0bfd81a8f3f8fa1583e3bff8b5"}},"mode":493,"user":{},"group":{}},{"filesystem":"root","path":"/opt/bin/tclient","contents":{"source":"https://github.com/hkjn/hkjninfra/releases/download/1.5.0/tclient_x86_64","verification":{"hash":"sha512-a4ea3a9258228e42cf4586581d70df439752bf548eec0ecb9d593dc6def3617ac6870f5bf293fd667283739f217eae3e563b72607f98968a07254092b768e791"}},"mode":493,"user":{},"group":{}},{"filesystem":"root","path":"/etc/ssl/mon_ca.pem","contents":{"source":"https://admin1.hkjn.me/151fb337c9b9a51b7027f10b8b20b46ea12dd4edb2427c57b19877075d227c039dad00db4049928501ec3963ded8e086b96ee9436e6d68b9c7524c68bc34d0bc/files/certs/mon_ca.pem","verification":{"hash":"sha512-cf8032384a17fc591f83030a3a536f8b80e79c7d6e5e839e5003b587163bf371a51ab1b14dc047486cfd55fb74238d69253fcb27d49245ba249359584b169bb4"}},"mode":493,"user":{},"group":{}}]},"systemd":{"units":[{"enable":true,"name":"tclient.service","contents":"[Unit]\nDescription=tclient\nAfter=network-online.target\n\n[Service]\nEnvironment=REPORT_ADDR=mon.hkjn.me:50051\nEnvironment=REPORT_FACTS_PATH=/etc/report_facts.json\nEnvironment=REPORT_TLS_CA_CERT=/etc/ssl/mon_ca.pem\nEnvironment=REPORT_TLS_CERT=/etc/ssl/client.pem\nEnvironment=REPORT_TLS_KEY=/etc/ssl/client-key.pem\n\nExecStartPre=-/bin/bash -c \"/opt/bin/gather_facts \u003e /etc/report_facts.json\"\nExecStart=/opt/bin/tclient\n\n[Install]\nWantedBy=multi-user.target\n"},{"enable":true,"name":"tclient.timer","contents":"[Unit]\nDescription=Timer that starts report_client.service\n\n[Timer]\n# Run every 5 min.\nOnCalendar=*:0/5\nPersistent=true\n\n[Install]\nWantedBy=multi-user.target\n"},{"enable":true,"name":"bitcoin.service","contents":"[Unit]\nDescription=bitcoind\nAfter=network-online.target\n\n[Service]\nExecStartPre=-/bin/bash -c \"docker pull hkjn/bitcoin:$(uname -m)\"\nExecStartPre=-/usr/bin/docker stop bitcoin\nExecStartPre=-/usr/bin/docker rm bitcoin\nExecStart=/bin/bash -c \" \\\n  docker run --name bitcoin \\\n             -p 8333:8333 \\\n             --memory=1050m \\\n             --cpu-shares=128 \\\n             -v /containers/bitcoin:/home/bitcoin/.bitcoin \\\n             hkjn/bitcoin:$(uname -m) -dbcache=800 -onlynet=ipv4 -printtoconsole\"\nRestart=always\n\n[Install]\nWantedBy=multi-user.target\n"},{"enable":true,"name":"containers.mount","contents":"[Mount]\nWhat=/dev/disk/by-id/scsi-0Google_PersistentDisk_persistent-disk-1-part1\nWhere=/containers\nType=xfs\n\n[Install]\nRequiredBy=local-fs.target\n"},{"enable":false,"name":"docker.service","dropins":[{"name":"10_override_storage.conf","contents":"[Service]\nEnvironment=\"DOCKER_OPTS=-g /containers/docker -s overlay2\"\n"}]}],"passwd":{},"networkd":{}}}
